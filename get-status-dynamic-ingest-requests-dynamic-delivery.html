<!DOCTYPE html>
<html  lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
<script>(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-2728311-17", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");</script>
<meta name="Generator" content="Drupal 8 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="sites/default/files/favicon-64.png" type="image/png" />
<link rel="alternate" hreflang="en" href="get-status-dynamic-ingest-requests-dynamic-delivery.html" />
<link rel="canonical" href="get-status-dynamic-ingest-requests-dynamic-delivery.html" />
<link rel="shortlink" href="get-status-dynamic-ingest-requests-dynamic-delivery.html" />
<link rel="revision" href="get-status-dynamic-ingest-requests-dynamic-delivery.html" />

    <title>Get Status of Dynamic Ingest Requests (Dynamic Delivery) | Brightcove Learning</title>
    <link rel="stylesheet" media="all" href="sites/default/files/css/css_d7PoQ20hWbRiei75VgExP_tm8C1ylIRfzB3zIYLc5Cw_q23msc.css" />
<link rel="stylesheet" media="all" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" />
<link rel="stylesheet" media="all" href="https://cdn.jsdelivr.net/npm/@unicorn-fail/drupal-bootstrap-styles@0.0.2/dist/3.4.0/8.x-3.x/drupal-bootstrap.min.css" />


    
<!--[if lte IE 8]>
<script src="/sites/default/files/js/js_VtafjXmRvoUgAzqzYTA3Wrjkx9wcWhjP0G4ZnnqRamA.js"></script>
<![endif]-->

    <meta name="uri-translation" content="on" />
    <script>
window['_fs_debug'] = false; window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = 'BX3Q1';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};
g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
g.consent=function(a){g("consent",!arguments.length||a)};
g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
g.clearUserCookie=function(){};
})(window,document,window['_fs_namespace'],'script','user');
    </script>
  </head>
  <body class="path-node page-node-type-support-doc has-glyphicons">


<section id="block-gtranslate" class="block block-gtranslate block-gtranslate-block clearfix">
  
    

      



  </section>


  </div>

      </div>
      

                    <div class="navbar-collapse collapse">
            <div class="region region-navigation-collapsible">
    

  </div>

        </div>
          </header>
  
    <div class="full-width-headline">
    <div class="container">
      <div class="row">
        <div class="col-sm-12" role="heading">
            <div class="region region-header">
          <section id="block-brightcoveheadlineblock" class="block block-bc-general block-bc-general-headline-block clearfix">
  
    

      Documentation
  </section>


  </div>

        </div>
      </div>
    </div>
  </div>
  
      <div role="main" class="main-container container  js-quickedit-main-content">
    <div class="row">

                              <aside class="col-sm-3" role="complementary">
              <div class="region region-sidebar-first">
    <section class="bc-search-fixes-search-block-form block block-bc-search-fixes block-bc-search-fixes-search-block clearfix" data-drupal-selector="bc-search-fixes-search-block-form" id="block-brightcovesearchblock">
  
    

      <form action="get-status-dynamic-ingest-requests-dynamic-delivery.html" method="post" id="bc-search-fixes-search-block-form" accept-charset="UTF-8">
  <div class="form-item js-form-item form-type-textfield js-form-type-textfield form-item-search js-form-item-search form-no-label form-group">
      <label for="edit-search" class="control-label sr-only">Search</label>
  
  
  <input data-drupal-selector="edit-search" class="form-text form-control" type="text" id="edit-search" name="search" value="" size="15" maxlength="128" placeholder="Search" />

  
  
  </div>
<input autocomplete="off" data-drupal-selector="form-ou-jl4mlu0p5v-ol83aepbtovuduuxsw6bixbyct1-g" type="hidden" name="form_build_id" value="form-ou-Jl4mLU0P5v-oL83aEPbToVuduUxsW6BixBycT1-g" /><input data-drupal-selector="edit-bc-search-fixes-search-block-form" type="hidden" name="form_id" value="bc_search_fixes_search_block_form" /><div data-drupal-selector="edit-actions" class="form-actions form-group js-form-wrapper form-wrapper" id="edit-actions"><button data-drupal-selector="edit-submit" class="button js-form-submit form-submit btn-primary btn icon-only" type="submit" id="edit-submit" name="op" value="Search"><span class="sr-only">Search</span><span class="icon glyphicon glyphicon-search" aria-hidden="true"></span></button></div>

</form>

  </section>

<section id="block-inpagenavigationblock" class="hidden-xs block block-bc-ipnav block-bc-ipnav-block clearfix">
  
      <h2 class="block-title">On This Page</h2>
    

      <div class="bc-ipnav-block"></div>
  </section>


  </div>

          </aside>
              
                  <section class="col-sm-9">

                                      <div class="highlighted">  <div class="region region-highlighted">
    <div data-drupal-messages-fallback class="hidden"></div>

  </div>
</div>
                  
                
                
                
                          <a id="main-content"></a>
            <div class="region region-content">
        <h1 class="page-header"><span>Get Status of Dynamic Ingest Requests (Dynamic Delivery)</span>
</h1>

  
<div class="node node--type-support-doc node--view-mode-full bcdocs-four-rows clearfix">

  

  <div class="group-first-row">
      </div>

  <div class="group-second-row">
  
  <div class="field field--name-field-products field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Product(s)</div>
          <div class="field__items taxonomy__tags">
        <svg class="icon--product" viewBox="0 0 100 100">
          <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--product"></use>
        </svg>
              <div class="field--item">Video Cloud</div>
              </div>
      </div>

  <div class="field field--name-field-roles field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Role(s)</div>
          <div class="field__items taxonomy__tags">
        <svg class="icon--roles" viewBox="0 0 100 100">
          <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--roles"></use>
        </svg>
              <div class="field--item">API Developer</div>
              </div>
      </div>

</div>

  
<div class="group-third-row taxonomy__tags">
      <svg class="icon--label" viewBox="0 0 100 100">
      <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--label"></use>
    </svg>
    
  <div class="field field--name-field-topics field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Topic(s)</div>
          <div class="field--items">
              <div class="field--item">Dynamic Delivery</div>
          <div class="field--item">Notifications</div>
              </div>
      </div>

  <div class="field field--name-field-apis field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">API(s)</div>
          <div class="field--items">
              <div class="field--item">Dynamic Ingest API</div>
              </div>
      </div>

</div>

  <div class="group-fourth-row">
  
            <div class="field field--name-field-support-doc-body field--type-text-with-summary field--label-hidden field--item"><p>When you use the Dynamic Ingest API to add videos to your Video Cloud account, what you most want to know is when the video has been processed and whether or not renditions were successfully created. .</p>
<article class="bcls-article"><section class="bcls-section"><h2 id="introduction">Introduction</h2>

<p>This document explains how you can track the status of jobs by either making status requests to the CMS API or by using Dynamic Ingest API <a href="notifications-dynamic-delivery-video-cloud.html">notifications</a>. We also provide a sample dashboard app that automates the process</p>

<p>Note that the status of ingest jobs is available only for jobs submitted with the past 7 days.</p>
</section><section class="bcls-section"><h2 id="requesting_status">Requesting status</h2>

<p>You get the status of dynamic ingest jobs (ingest, replace, or retranscode) using <a href="https://docs.brightcove.com/cms-api/v1/doc/index.html#operation/GetStatusOfIngestJob">these CMS API endpoints</a> - note that these endpoints works for <strong>Dynamic Delivery jobs only</strong>:</p>

<h3>Get status for all jobs</h3>

<pre>
<code class="language-http">https://cms.api.brightcove.com/v1/accounts/{account_id}/videos/{video_id}/ingest_jobs</code></pre>

<p>The response will look something like this:</p>

<pre class="line-numbers">
 <code class="language-json">[
  {
    "id": "ac49b1db-e6e1-477f-a2c1-70b9cd3107cb",
    "state": "finished",
    "account_id": "57838016001",
    "video_id": "5636411346001",
    "error_code": null,
    "error_message": null,
    "updated_at": "2017-11-07T13:56:51.505Z",
    "started_at": "2017-11-07T13:56:12.510Z",
    "priority": "normal",
    "submitted_at": "2017-11-07T13:56:12.435Z"
  },
  {
    "id": "10605652-8b6f-4f22-b190-01bd1938677b",
    "state": "processing",
    "account_id": "57838016001",
    "video_id": "5636411346001",
    "error_code": null,
    "error_message": null,
    "updated_at": null,
    "started_at": null,
    "priority": "low",
    "submitted_at": "2017-11-07T14:06:35.000Z"
  }
]</code></pre>

<h3>Get status for a spefific jobs</h3>

<pre>
<code class="language-http">https://cms.api.brightcove.com/v1/accounts/{account_id}/videos/{video_id}/ingest_jobs/{job_id}</code></pre>

<p>The response will look something like this:</p>

<pre class="line-numbers">
<code class="language-json">{
    "id": "ac49b1db-e6e1-477f-a2c1-70b9cd3107cb",
    "state": "finished",
    "account_id": "57838016001",
    "video_id": "5636411346001",
    "error_code": null,
    "error_message": null,
    "updated_at": "2017-11-07T13:56:51.505Z",
    "started_at": "2017-11-07T13:56:12.510Z",
    "priority": "normal",
    "submitted_at": "2017-11-07T13:56:12.435Z"
  }</code></pre>

<p>The possible values for <code>state</code> are:</p>

<ul><li><code>processing</code>: processing, video is not playable yet</li>
	<li><code>publishing</code>: at least one playable rendition has been created, and the video is being readied for playback</li>
	<li><code>published</code>: at least one rendition is a available for playback</li>
	<li><code>finished</code>: all processing is complete</li>
	<li><code>failed</code>: processing failed; if you are not able to figure out what went wrong, contact Support</li>
</ul></section><section class="bcls-section" id="dataSources"><h2>Getting notifications</h2>

<p>While the request status method discussed above works, if you are waiting for a particular state (<code>published</code> or <code>finished</code>), it is better to let Brightcove notify you when these events occur rather than have to keep asking for the status until you get the answer you are looking for. We will now look at how you might build an app around handling notifications.</p>

<p>The Dynamic Ingest notifications give you all the information you need to know when your video is ready - you just need to know what to look for...and to define what "ready" means for your systems. This diagram summarizes the workflow:</p>

<figure class="bcls-figure"><img class="bcls-image" alt="Ingest Status Workflow" src="https://learning-services-media.brightcove.com/doc-assets/node/18501-get-status-dynamic-ingest-requests-dynamic-delivery/18501-ingestion-status-architecture.svg" /><figcaption class="bcls-caption--image">Ingest Status Workflow</figcaption></figure></section><section id="Dynamic_Ingest_Notifications" class="bcls-section"><h2>Dynamic Ingest Notifications</h2>

<p>The Dynamic Ingest notification service sends you notifications for several kinds of events. The two that are most useful for figuring out when the video is "ready" are ones indicating that particular renditions have been created and the one that indicates that all processing is complete. Here are examples of each:</p>

<h3>Dynamic rendition created notification</h3>

<figure class="bcls-figure"><pre class="line-numbers">
<code class="language-json">{
  <span class="bcls-hightlight">"entity": "default/video3800",</span>
  <span class="bcls-hightlight">"entityType": "DYNAMIC_RENDITION",</span>
  "version": "1",
  <span class="bcls-hightlight">"action": "CREATE",</span>
  "jobId": "d3ef8751-2b88-4141-95d5-83f0393aca07",
  "videoId": "5660367449001",
  "dynamicRenditionId": "default\/video3800",
  "bitrate": 3804,
  "width": 1920,
  "height": 1080,
  "accountId": "57838016001",
  <span class="bcls-hightlight">"status": "SUCCESS"</span>
}
</code>
</pre>

<figcaption class="bcls-caption--image">Notification for Rendition Created</figcaption></figure><p>Note in this example:</p>

<ul><li>The <code>videoId </code> value lets you know which video the rendition is for (in case you have multiple ingest jobs running)</li>
	<li>The <code>entity </code> value is the dynamic rendition type created</li>
	<li>if the <code>status </code> value is "SUCCESS", the rendition was created successfully</li>
</ul><h3>Processing complete notification</h3>

<figure class="bcls-figure"><pre class="line-numbers">
<code class="language-json">{
  "entity": "5660367449001",
  <span class="bcls-hightlight">"entityType": "TITLE",</span>
  "version": "1",
  <span class="bcls-hightlight">"action": "CREATE",</span>
  "jobId": "d3ef8751-2b88-4141-95d5-83f0393aca07",
  "videoId": "5660367449001",
  "accountId": "57838016001",
  <span class="bcls-hightlight">"status": "SUCCESS"</span>
}
</code>
</pre>

<figcaption class="bcls-caption--image">Notification for Processing Complete</figcaption></figure><p>Note in this example:</p>

<ul><li>The <code>videoId </code> and <code>jobId </code> values let you know which video this is for (in case you have multiple ingest jobs running)</li>
	<li>If the <code>status </code> value is "SUCCESS", the video was processed successfully</li>
</ul><p>To receive notifications, you need to include a "callbacks" field in you Dynamic Ingest API requests, pointing to one or more callback addresses:</p>

<pre class="line-numbers">
<code class="language-json">{
  "master": {
  "url": "https://s3.amazonaws.com/bucket/mysourcevideo.mp4"
  }, "profile": "multi-platform-extended-static",
  <strong>"callbacks": ["http://host1/path1”, “http://host2/path2”]</strong>
}
</code>
</pre>
</section><section class="bcls-section" id="sample"><h2>Sample Dashboard</h2>

<p>This section explains how notifications can be put together to build a simple dashboard for the Dynamic Ingest API. The handler for notifications parses notifications from the Dynamic Ingest API to identify processing complete notifications. It then adds the video notifications into an array of objects for each video in a JSON file. The dashboard itself is an HTML page that imports the JSON file to get the notification data. It uses the ids to makes a request to the <a href="overview-cms-api.html">CMS API</a> to get the video metadata.</p>
<!-- You can view the dashboard <a href="//solutions.brightcove.com/bcls/di-api/di-log.html">here</a> --><!-- <p>All the files for this app, along with instructions for setting it up for your account, are in <a href="https://github.com/BrightcoveLearning/dynamic-ingest-dashboard">this repository</a>.</p> -->

<p>Here is the high-level architecture of the app:</p>

<figure class="bcls-figure"><img class="bcls-image" alt="Ingest Dashboad Architecture" src="https://learning-services-media.brightcove.com/doc-assets/video-cloud-apis/general-information/di-status/ingestion-dashboard-architecture.svg" /><figcaption class="bcls-caption--image">Ingest Dashboad Architecture</figcaption></figure><h3>The app parts</h3>

<p>The handler for notifications is built in PHP - it looks for processing complete notifications and adds the video id to an array in a separate JavaScript file:</p>

<pre class="line-numbers">
<code class="language-php">&lt;?php
  // POST won't work for JSON data
  $problem = "No errors";
  try {
    $json    = file_get_contents('php://input');
    $decoded = json_decode($json, true);
  } catch (Exception $e) {
    $problem = $e-&gt;getMessage();
    echo $problem;
  }

  // full notification
  $notification = json_encode($decoded, JSON_PRETTY_PRINT);

  // Begin by extracting the useful parts of the notification
  // for Dynamic Delivery, look for 'videoId'
  // for the legacy ingest system, the video id is the 'entity'

  if (isset($decoded["videoId"])) {
    $videoId = $decoded["videoId"];
  } elseif (isset($decoded["entity"])) {
    $videoId = $decoded["entity"];
  } else {
    $videoId = null;
  }

  if (isset($decoded["entityType"])) {
    $entityType = $decoded["entityType"];
  } else {
    $entityType = null;
  }

  if (isset($decoded["status"])) {
    $status = $decoded["status"];
  } else {
    $status = null;
  }

  if (isset($decoded["action"])) {
    $action = $decoded["action"];
  } else {
    $action = null;
  }

  // if notification is for completed title, act

  if (($entityType == 'TITLE') &amp;&amp; ($action == 'CREATE')) {
    if (($status == 'SUCCESS') || ($status == 'FAILED')) {
      $newLine = "\nvideoIdArray.unshift(".$videoId.");";
      // Tell PHP where it can find the log file and tell PHP to open it
      // and add the string we created earlier to it.
      $logFileLocation = "video-ids.js";
      $fileHandle      = fopen($logFileLocation, 'a') or die("-1");
      chmod($logFileLocation, 0777);
      fwrite($fileHandle, $newLine);
      fclose($fileHandle);
    }
  }

  // save full notification for audit trail
  $logEntry = $notification.",\n";

  $logFileLocation = "full-log.txt";
  $fileHandle      = fopen($logFileLocation, 'a') or die("-1");
  chmod($logFileLocation, 0777);
  fwrite($fileHandle, $logEntry);
  fclose($fileHandle);


  echo "Dynamic Ingest callback app is running";
  ?&gt;
  </code>
  </pre>

<h4>JSON file:</h4>

<p>The JSON file is initially an empty array ( <code>[] </code>) - data is added by the notification handler.</p>

<h4>Dashboard</h4>

<p>The dashboard includes the HTML and JavaScript to fetch the notification data and additional video data from the CMS API and write the results into a table:</p>

<pre class="line-numbers">
  <code class="language-html">&lt;!DOCTYPE html&gt;
  &lt;html&gt;
  &lt;head&gt;
    &lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
    &lt;title&gt;Dynamic Ingest Log&lt;/title&gt;
    &lt;style&gt;
    body {
    font-family: sans-serif;
    margin: 5em;
    }
    .hide {
    display: none;
    }
    .show {
    display: block;
    }
    table {
    border-collapse: collapse;
    border: 1px #999999 solid;
    }
    th {
    background-color: #666666;
    color: #f5f5f5;
    padding: .5em;
    font-size: .7em;
    }
    td {
    border: 1px #999999 solid;
    font-size: .7em;
    padding: .5em
    }
    .hidden {
    display: none;
    }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Dynamic Ingest Log&lt;/h1&gt;
    &lt;h2&gt;Account: Brightcove Learning (57838016001)&lt;/h2&gt;
    &lt;p style="width:70%"&gt;
      Videos are listed in order of processing completion time, newest to oldest. The reference id (generated by the &lt;a href="./di-tester.html"&gt;Dynamic Ingest tester&lt;/a&gt;) is a combination of the date/time that the Dynamic Ingest job was initiated and the ingest profile that was used. You can add additional videos using the &lt;a href="./di-tester.html"&gt;Dynamic Ingest tester&lt;/a&gt;. New videos will appear in this log after processing is complete.
    &lt;/p&gt;
    &lt;p&gt;
      &lt;button id="clearLogBtn"&gt;Clear the log&lt;/button&gt;
    &lt;/p&gt;
    &lt;div id="videoLogBlock"&gt;
      &lt;table&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt;Video ID&lt;/th&gt;
            &lt;th&gt;Name&lt;/th&gt;
            &lt;th&gt;Reference ID&lt;/th&gt;
            &lt;th&gt;Renditions Created&lt;/th&gt;
            &lt;th&gt;Processing Complete&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody id="logBody"&gt;&lt;/tbody&gt;
      &lt;/table&gt;
      &lt;h4 id="loadingMessage"&gt;Loading data, please wait...&lt;/h4&gt;
    &lt;/div&gt;
    &lt;script&gt;
    var BCLS = ( function (window, document) {
      // to use another account, set the account_id value appropriately
      // the client_id and client_secret will also need to be changed in the proxy
      var my_account_id = 57838016001,
        account_id = my_account_id,
        logBody = document.getElementById('logBody'),
        loadingMessage = document.getElementById('loadingMessage'),
        clearLogBtn = document.getElementById('clearLogBtn'),
        i = 0,
        iMax,
        // set the proxyURL to the location of the proxy app that makes Brightcove API requests
        proxyURL = './brightcove-learning-proxy.php',
        dataFileURL = './di.json',
        videoDataArray = [],
        requestOptions = {},
        currentVideo,
        currentIndex = 0;
      /**
      * tests for all the ways a variable might be undefined or not have a value
      * @param {*} x the variable to test
      * @return {Boolean} true if variable is defined and has a value
      */
      function isDefined(x) {
        if ( x === '' || x === null || x === undefined || x === NaN) {
        return false;
      }
      return true;
      }
      /**
      * find index of an object in array of objects
      * based on some property value
      *
      * @param {array} targetArray - array to search
      * @param {string} objProperty - object property to search
      * @param {string|number} value - value of the property to search for
      * @return {integer} index of first instance if found, otherwise returns null
      */
      function findObjectInArray(targetArray, objProperty, value) {
        var i, totalItems = targetArray.length, objFound = false;
        for (i = 0; i &lt; totalItems; i++) {
          if (targetArray[i][objProperty] === value) {
            objFound = true;
            return i;
          }
        }
        if (objFound === false) {
          return null;
        }
      }
      /**
      * factory for new video objects
      * @param {String} videoId the video id
      * @return {object} the new object
      */
      function makeVideoDataObject(videoId) {
        var obj = {};
        obj.id = videoId;
        obj.name = '';
        obj.reference_id = '';
        obj.renditions = 0;
        obj.complete = 'no';
        return obj;
      }
      /**
      * processes notification objects
      * creates a new object in the videoDataArray if it doesn't exist
      * and updates the videoDataArray object based on the notification
      * @param {Object} notificationObj the raw notification object
      */
      function processNotification(notificationObj) {
        var objIndex, videoObj;
        // if notification object contains a video id, find the corresponding
        // object in the videoDataArray or create it if it's not there
        if (isDefined(notificationObj) &amp;&amp; isDefined(notificationObj.videoId)) {
          objIndex = findObjectInArray(videoDataArray, 'id', notificationObj.videoId);
          // if not found, create one
          if (!isDefined(objIndex)) {
            videoObj = makeVideoDataObject(notificationObj.videoId);
            videoDataArray.push(videoObj);
            objIndex = videoDataArray.length - 1;
          }
          // now update properties based on what's in the notification
          if (notificationObj.entityType === 'DYNAMIC_RENDITION') {
            // increment the renditions account
            videoDataArray[objIndex].renditions++;
          }
        } else if (notificationObj.entityType === 'TITLE') {
          // overall processing notification - checked for SUCCESS / FAILED
          if (notificationObj.status === 'SUCCESS') {
            // mark complete
            videoDataArray[objIndex].complete = 'yes';
          } else if (notificationObj.status === 'FAILED') {
            // mark failed
            videoDataArray[objIndex].complete = 'failed';
          }
        }
        return;
      }
      /**
      * creates the dashboard table body
      */
      function writeReport() {
        var j,
          jMax = videoDataArray.length,
          item,
          t;
        loadingMessage.textContent = 'This page will refresh in 1 minute...';
        for (j = 0; j &lt; jMax; j++) {
          item = videoDataArray[j];
          if (item.id !== undefined) {
            logBody.innerHTML += '&lt;tr&gt;&lt;td&gt;' + item.id + '&lt;/td&gt;&lt;td&gt;' + item.name + '&lt;/td&gt;&lt;td&gt;' + item.reference_id + '&lt;/td&gt;&lt;td&gt;' + item.renditons + '&lt;/td&gt;&lt;td&gt;' + item.complete + '&lt;/td&gt;&lt;/tr&gt;';
          }
        }
        // set timeout for refresh
        t = window.setTimeout(init, 60000);
      };
      // function to set up the notification data request
      function setJSONRequestOptions() {
        submitRequest(null, dataFileURL, 'notificationData');
      }
      // function to set up video data request
      function setVideoRequestOptions() {
        requestOptions = {};
        requestOptions.url = 'https://cms.api.brightcove.com/v1/accounts/' + account_id + '/videos/' + currentVideo.id;
        submitRequest(requestOptions, proxyURL, 'video');
      }
      /**
      * initiates the cms api requests
      */
      function getVideoInfo() {
        iMax = videoDataArray.length;
        if (currentIndex &lt; iMax) {
          currentVideo = videoDataArray[currentIndex];
          setVideoRequestOptions();
        } else {
          loadingMessage.innerHTML = 'No videos have been ingested - you can add some using the &lt;a href="./di-tester.html"&gt;Dynamic Ingest tester&lt;/a&gt;';
        }
      }
      /**
      * make the cms api requests
      * @param {Object} options request options
      * @param (String) url URL to send request to
      * @param (String) type the request type
      */
      function submitRequest(options, url, type) {
        var httpRequest = new XMLHttpRequest(),
          requestData,
          responseData,
          videoDataObject,
          parsedData,
          getResponse = function () {
          try {
            if (httpRequest.readyState === 4) {
              if (httpRequest.status === 200) {
                responseData = httpRequest.responseText;
                switch (type) {
                  case 'notificationData':
                      var k, kMax, dataArray;
                      dataArray = JSON.parse(responseData);
                      // process the notifications
                      kMax = dataArray.length;
                      for (k = 0; k &lt; kMax; k++) {
                      processNotification(dataArray[k]);
                    }
                    getVideoInfo();
                    break;
                  case 'video':
                    parsedData = JSON.parse(responseData);
                    videoDataArray[currentIndex].reference_id = parsedData.reference_id;
                    videoDataArray[currentIndex].name = parsedData.name;
                    currentIndex++;
                    if (currentIndex &lt; iMax) {
                    currentVideo = videoDataArray[currentIndex];
                    setVideoRequestOptions();
                    } else {
                    writeReport();
                    }
                    break;
                }
              } else {
                console.log('There was a problem with the request. Request returned '', httpRequest.status);
                if (type === 'video') {
                  setVideoRequestOptions();
                } else {
                  setSourcesRequestOptions();
                }
              }
            }
          }
          catch(e) {
          console.log('Caught Exception: ', e);
          }
        };
        // notifications data is a special case
        if (type === 'notificationData') {
          // set response handler
          httpRequest.onreadystatechange = getResponse;
          // open the request
          httpRequest.open("GET", url);
          // set headers
          httpRequest.setRequestHeader("Content-Type", "application/json");
          // open and send request
          httpRequest.send();
        } else {
          // requests via proxy
          // set up request data
          requestData = "url=" + encodeURIComponent(options.url) + "&amp;requestType=GET";
          // set response handler
          httpRequest.onreadystatechange = getResponse;
          // open the request
          httpRequest.open("POST", url);
          // set headers
          httpRequest.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
          // open and send request
          httpRequest.send(requestData);
        }
      };
      // event handlers
      clearLogBtn.addEventListener('click', function () {
        if (window.confirm('Are you sure? This action cannot be undone!')) {
        // if your clear-log app resides in another location, change the URL
        window.location.href = 'clear-log.php';
        }
      });
      // get things started
      function init() {
        // clear table and the video data array
        logBody.innerHTML = "";
        videoDataArray = [];
        setJSONRequestOptions();
      }
      // kick off the app
      init();
    })(window, document);
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code>
</pre>

<aside class="bcls-aside bcls-aside--tip">There's a design choice to be made here: you can use the notification handler or the dashboard (or a combination of the two) to process the notifications and extract the useful information. In this kind of app, we prefer to keep the notification handler simple, just using it to pass on the notification data, and let the client app (in this case the dashboard) do the information processing. This requires more processing on the client, but make the notification handler more reusable.</aside><h4>Proxy</h4>

<pre class="line-numbers">
<code class="language-php">&lt;?php
/**
* brightcove-learning-proxy.php - proxy for Brightcove RESTful APIs
* gets an access token, makes the request, and returns the response
* Accessing:
*     URL: https://solutions.brightcove.com/bcls/bcls-proxy/bcsl-proxy.php
*         (note you should *always* access the proxy via HTTPS)
*     Method: POST
*
* @post {string} url - the URL for the API request
* @post {string} [requestType=GET] - HTTP method for the request
* @post {string} [requestBody=null] - JSON data to be sent with write requests
*
* @returns {string} $response - JSON response received from the API
*/
// CORS enablement
header("Access-Control-Allow-Origin: *");
// set up request for access token
$data = array();
//
// change the values below to use this proxy with a different account
//
$client_id     = "YOUR_CLIENT_ID_HERE";
$client_secret = "YOUR_CLIENT_SECRET_HERE";
$auth_string   = "{$client_id}:{$client_secret}";
$request       = "https://oauth.brightcove.com/v4/access_token?grant_type=client_credentials";
$ch            = curl_init($request);
curl_setopt_array($ch, array(
CURLOPT_POST           =&gt; TRUE,
CURLOPT_RETURNTRANSFER =&gt; TRUE,
CURLOPT_SSL_VERIFYPEER =&gt; FALSE,
CURLOPT_USERPWD        =&gt; $auth_string,
CURLOPT_HTTPHEADER     =&gt; array(
'Content-type: application/x-www-form-urlencoded',
),
CURLOPT_POSTFIELDS =&gt; $data
));
$response = curl_exec($ch);
curl_close($ch);
// Check for errors
if ($response === FALSE) {
die(curl_error($ch));
}
// Decode the response
$responseData = json_decode($response, TRUE);
$access_token = $responseData["access_token"];
// set up the API call
// get data
if ($_POST["requestBody"]) {
$data = json_decode($_POST["requestBody"]);
} else {
$data = array();
}
// get request type or default to GET
if ($_POST["requestType"]) {
$method = $_POST["requestType"];
} else {
$method = "GET";
}
// get the URL and authorization info from the form data
$request = $_POST["url"];
//send the http request
$ch = curl_init($request);
curl_setopt_array($ch, array(
CURLOPT_CUSTOMREQUEST  =&gt; $method,
CURLOPT_RETURNTRANSFER =&gt; TRUE,
CURLOPT_SSL_VERIFYPEER =&gt; FALSE,
CURLOPT_HTTPHEADER     =&gt; array(
'Content-type: application/json',
"Authorization: Bearer {$access_token}",
),
CURLOPT_POSTFIELDS =&gt; json_encode($data)
));
$response = curl_exec($ch);
curl_close($ch);
// Check for errors
if ($response === FALSE) {
echo "Error: "+$response;
die(curl_error($ch));
}
// Decode the response
// $responseData = json_decode($response, TRUE);
// return the response to the AJAX caller
echo $response;
?&gt;
</code>
</pre>

<h4>Clear the log</h4>

<p>This simple PHP app just restores the JavaScript file to its original state, clearing out the old video ids:</p>

<pre class="line-numbers">
<code class="language-php">&lt;?php
$logFileLocation = "di.json";
$freshContent = array ();
$encodedContent = json_encode($freshContent);
file_put_contents($logFileLocation, $encodedContent);
echo 'Log file cleared - &lt;a href="di-log.html"&gt;go back to the dashboard&lt;/a&gt;';
?&gt;
</code>
</pre>
</section></article></div>
      
</div>

</div>


<section class="views-element-container block block-views block-views-blockrelated-content-by-field-block-1 clearfix" id="block-views-block-related-content-by-field-block-1">
  
    

      <div class="form-group"><div class="view view-related-content-by-field view-id-related_content_by_field view-display-id-block_1 js-view-dom-id-c20b5b51637587af2413619dbfc82ababb7541f4efc2a080b08ced1e03f2696b">
  
    
      <div class="view-header">
      <h2>Related content</h2>
    </div>
      
      <div class="view-content">
      <div class="item-list">
  
  <ul>

          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="overview-dynamic-ingest-api-dynamic-delivery.html" hreflang="en"> Overview: Dynamic Ingest API for Dynamic Delivery</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="notifications-dynamic-delivery-video-cloud.html" hreflang="en">Notifications for Dynamic Delivery in Video Cloud</a></span></span></div></li>
    
  </ul>

</div>

    </div>
  
          </div>
</div>

  </section>


  </div>

              </section>

                </div>
  </div>

      
  
  </div>

    
    <script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","scriptPath":null,"pathPrefix":"","currentPath":"node\/18501","currentPathIsAdmin":false,"isFront":false,"currentLanguage":"en"},"pluralDelimiter":"\u0003","google_analytics":{"trackOutbound":true,"trackMailto":true,"trackDownload":true,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"},"bootstrap":{"forms_has_error_value_toggle":1,"modal_animation":1,"modal_backdrop":"true","modal_focus_input":1,"modal_keyboard":1,"modal_select_text":1,"modal_show":1,"modal_size":"","popover_enabled":1,"popover_animation":1,"popover_auto_close":1,"popover_container":"body","popover_content":"","popover_delay":"0","popover_html":0,"popover_placement":"right","popover_selector":"","popover_title":"","popover_trigger":"click"},"ajaxTrustedUrl":{"form_action_p_pvdeGsVG5zNF_XLGPTvYSKCf43t8qZYSwcfZl2uzM":true},"user":{"uid":0,"permissionsHash":"3b7fdb4927baca3ee2939edeb777485b3e2c2d36cf8c80e0d8f49c6dc5e2eeca"}}</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

  <script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","licenseKey":"e78a80aa93","applicationID":"129613202","transactionName":"YwBUZkcFVktUWhJQX1pKd1FBDVdWGn0UTEBVCWpxWhZdZHNWFFRscgpEX3cRUVRRXBQUDkYAWFZQFmhUVFoDUV9YAVNAcwtKVXRaElBfWg==","queueTime":0,"applicationTime":351,"atts":"T0dXEA8fRUU=","errorBeacon":"bam.nr-data.net","agent":""}</script></body>
</html>
