<!DOCTYPE html>
<html  lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
<script>(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-2728311-17", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");</script>
<meta name="Generator" content="Drupal 8 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="sites/default/files/favicon-64.png" type="image/png" />
<link rel="alternate" hreflang="en" href="selecting-captions-programmatically-native-sdk-android.html" />
<link rel="canonical" href="selecting-captions-programmatically-native-sdk-android.html" />
<link rel="shortlink" href="selecting-captions-programmatically-native-sdk-android.html" />
<link rel="revision" href="selecting-captions-programmatically-native-sdk-android.html" />

    <title>Selecting Captions Programmatically with the Native SDK for Android | Brightcove Learning</title>
    <link rel="stylesheet" media="all" href="sites/default/files/css/css_d7PoQ20hWbRiei75VgExP_tm8C1ylIRfzB3zIYLc5Cw_q23msc.css" />
<link rel="stylesheet" media="all" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" />
<link rel="stylesheet" media="all" href="https://cdn.jsdelivr.net/npm/@unicorn-fail/drupal-bootstrap-styles@0.0.2/dist/3.4.0/8.x-3.x/drupal-bootstrap.min.css" />


    
<!--[if lte IE 8]>
<script src="/sites/default/files/js/js_VtafjXmRvoUgAzqzYTA3Wrjkx9wcWhjP0G4ZnnqRamA.js"></script>
<![endif]-->

    <meta name="uri-translation" content="on" />
    <script>
window['_fs_debug'] = false; window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = 'BX3Q1';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};
g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
g.consent=function(a){g("consent",!arguments.length||a)};
g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
g.clearUserCookie=function(){};
})(window,document,window['_fs_namespace'],'script','user');
    </script>
  </head>
  <body class="path-node page-node-type-support-doc has-glyphicons">


<section id="block-gtranslate" class="block block-gtranslate block-gtranslate-block clearfix">
  
    

      



  </section>


  </div>

      </div>
      

                    <div class="navbar-collapse collapse">
            <div class="region region-navigation-collapsible">
    

  </div>

        </div>
          </header>
  
    <div class="full-width-headline">
    <div class="container">
      <div class="row">
        <div class="col-sm-12" role="heading">
            <div class="region region-header">
          <section id="block-brightcoveheadlineblock" class="block block-bc-general block-bc-general-headline-block clearfix">
  
    

      Documentation
  </section>


  </div>

        </div>
      </div>
    </div>
  </div>
  
      <div role="main" class="main-container container  js-quickedit-main-content">
    <div class="row">

                              <aside class="col-sm-3" role="complementary">
              <div class="region region-sidebar-first">
    <section class="bc-search-fixes-search-block-form block block-bc-search-fixes block-bc-search-fixes-search-block clearfix" data-drupal-selector="bc-search-fixes-search-block-form" id="block-brightcovesearchblock">
  
    

      <form action="selecting-captions-programmatically-native-sdk-android.html" method="post" id="bc-search-fixes-search-block-form" accept-charset="UTF-8">
  <div class="form-item js-form-item form-type-textfield js-form-type-textfield form-item-search js-form-item-search form-no-label form-group">
      <label for="edit-search" class="control-label sr-only">Search</label>
  
  
  <input data-drupal-selector="edit-search" class="form-text form-control" type="text" id="edit-search" name="search" value="" size="15" maxlength="128" placeholder="Search" />

  
  
  </div>
<input autocomplete="off" data-drupal-selector="form-g8knknekbhy-i19ep1w8-wk8qh2chp3if2qxaocaibe" type="hidden" name="form_build_id" value="form-g8KnknekBHy_I19Ep1W8-wk8qH2CHP3IF2QXaocaIBE" /><input data-drupal-selector="edit-bc-search-fixes-search-block-form" type="hidden" name="form_id" value="bc_search_fixes_search_block_form" /><div data-drupal-selector="edit-actions" class="form-actions form-group js-form-wrapper form-wrapper" id="edit-actions"><button data-drupal-selector="edit-submit" class="button js-form-submit form-submit btn-primary btn icon-only" type="submit" id="edit-submit" name="op" value="Search"><span class="sr-only">Search</span><span class="icon glyphicon glyphicon-search" aria-hidden="true"></span></button></div>

</form>

  </section>

<section id="block-inpagenavigationblock" class="hidden-xs block block-bc-ipnav block-bc-ipnav-block clearfix">
  
      <h2 class="block-title">On This Page</h2>
    

      <div class="bc-ipnav-block"></div>
  </section>


  </div>

          </aside>
              
                  <section class="col-sm-9">

                                      <div class="highlighted">  <div class="region region-highlighted">
    <div data-drupal-messages-fallback class="hidden"></div>

  </div>
</div>
                  
                
                
                
                          <a id="main-content"></a>
            <div class="region region-content">
        <h1 class="page-header"><span>Selecting Captions Programmatically with the Native SDK for Android</span>
</h1>

  
<div class="node node--type-support-doc node--view-mode-full bcdocs-four-rows clearfix">

  

  <div class="group-first-row">
      </div>

  <div class="group-second-row">
  
  <div class="field field--name-field-products field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Product(s)</div>
          <div class="field__items taxonomy__tags">
        <svg class="icon--product" viewBox="0 0 100 100">
          <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--product"></use>
        </svg>
              <div class="field--item">Video Cloud</div>
          <div class="field--item">Brightcove Player</div>
              </div>
      </div>

  <div class="field field--name-field-roles field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Role(s)</div>
          <div class="field__items taxonomy__tags">
        <svg class="icon--roles" viewBox="0 0 100 100">
          <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--roles"></use>
        </svg>
              <div class="field--item">Device SDK Developer</div>
              </div>
      </div>

</div>

  
<div class="group-third-row taxonomy__tags">
      <svg class="icon--label" viewBox="0 0 100 100">
      <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--label"></use>
    </svg>
    
  <div class="field field--name-field-topics field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Topic(s)</div>
          <div class="field--items">
              <div class="field--item">Captions</div>
              </div>
      </div>

  <div class="field field--name-field-sdk field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">SDK</div>
          <div class="field--items">
              <div class="field--item">Android</div>
              </div>
      </div>

</div>

  <div class="group-fourth-row">
  
            <div class="field field--name-field-support-doc-body field--type-text-with-summary field--label-hidden field--item"><summary>In this topic, you will learn how to programmatically select captions when using the Brightcove Native SDK for Android.</summary><article class="bcls-article">
<section class="bcls-section">
<h2 id="Overview">Overview</h2>

<p>The Native SDK for Android receives captions from either of the following:</p>

<ul>
	<li>Brightcove catalog response (Playback API) : Sidecar WebVTT</li>
	<li>Video manifest (HLS or DASH) : In-manifest WebVTT</li>
</ul>

<p>For more information about captions, see the <a href="https://sdks.support.brightcove.com/features/using-captions-brightcove-native-sdks.html">Using Captions with the Brightcove Native SDKs</a> document.</p>
</section>

<section class="bcls-section">
<h2 id="Event_sequence">Event sequence</h2>

<p>The Native SDK follows this event sequence associated with captions:</p>

<ol class="bcls-tasklist">
	<li>
	<p>Retrieve a video from the Brightcove catalog (ie. <code>catalog.findVideoByID()</code>).</p>
	</li>
	<li>
	<p>Sidecar captions are parsed from the catalog response and added to the video properties.</p>
	</li>
	<li>
	<p>At this point, you can retrieve caption sources as follows:</p>

	<pre>
<code class="language-java">video.getProperties().get(Video.Fields.CAPTION_SOURCES);</code></pre>
	</li>
	<li>
	<p>Set the video view. The video is added to ExoPlayer.</p>

	<pre>
<code class="language-java">brightcoveVideoView.add(video);</code></pre>
	</li>
	<li>
	<p>The Native SDK gets caption sources and emits the following event:</p>

	<pre>
<code class="language-java">EventType.CAPTIONS_LANGUAGES</code></pre>
	</li>
	<li>
	<p>After the video is added to ExoPlayer, the Native SDK looks for in-manifest captions. Any captions not already present in the video caption sources are added. If there are new caption sources, the following event is sent to update the Brightcove media controller.</p>

	<pre>
<code class="language-java">EventType.CAPTIONS_LANGUAGES</code></pre>
	</li>
</ol>
</section>

<section class="bcls-section">
<h2 id="Select_captions">Select captions</h2>

<p>Follow these steps to select captions programmatically:</p>

<ol class="bcls-tasklist__restart">
	<li>
	<p>Create a method to find an specific caption source with the language code. For example:</p>

	<pre>
<code class="language-java">private Pair&lt;Uri, BrightcoveCaptionFormat&gt; getCaptionsForLanguageCode(Video video, String languageCode) {
   Object payload = video == null ? null : video.getProperties().get(Video.Fields.CAPTION_SOURCES);

 if (payload instanceof List) {
   @SuppressWarnings("unchecked")
   List&lt;Pair&lt;Uri, BrightcoveCaptionFormat&gt;&gt; pairs =
      (List&lt;Pair&lt;Uri, BrightcoveCaptionFormat&gt;&gt;) payload;

   for (Pair&lt;Uri, BrightcoveCaptionFormat&gt; pair : pairs) {
     if (pair.second.language().equals(languageCode)) {
       return pair;
     }
   }
 }
 return null;
}</code></pre>
	</li>
	<li>
	<p>Notice that caption sources are in <code>Pair&lt;Uri, BrightcoveCaptionFormat&gt;</code>. The <code>Uri</code> in the pair indicates the type closed captions:</p>

	<ul>
		<li><strong>Sidecar</strong>: The full URL is present</li>
		<li><strong>In-manifest</strong>: The BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME is used</li>
	</ul>
	</li>
	<li>
	<p>Create a method responsible for selecting closed captions from a video with a given language code, by emitting the <code>EventType.SELECT_CLOSED_CAPTION_TRACK</code> event.</p>

	<pre>
<code class="language-java">private void selectCaption(Video video, String language) {
   Pair&lt;Uri, BrightcoveCaptionFormat&gt; pair = getCaptionsForLanguageCode(video, language);

 if (pair != null &amp;&amp; !pair.first.equals(Uri.EMPTY)) {
   // BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME indicates that is not a URL we need to load with the LoadCaptionsService, but instead we'll be enabled through a different component.
   if (!pair.first.toString().startsWith(BrightcoveCaptionFormat.BRIGHTCOVE_SCHEME)) {
     brightcoveVideoView.getClosedCaptioningController().getLoadCaptionsService().loadCaptions(pair.first, pair.second.type());
   }
   Map&lt;String, Object&gt; properties = new HashMap&lt;&gt;();
   properties.put(Event.CAPTION_FORMAT, pair.second);
   properties.put(Event.CAPTION_URI, pair.first);
   brightcoveVideoView.getEventEmitter().emit(EventType.SELECT_CLOSED_CAPTION_TRACK, properties);
 }
}</code></pre>
	</li>
	<li>
	<p>Listen to the <code>EventType.CAPTIONS_LANGUAGES</code> event and select the desired language by the language code.</p>

	<pre>
<code class="language-java">brightcoveVideoView.getEventEmitter().once(EventType.CAPTIONS_LANGUAGES, new EventListener() {
 @Override
 public void processEvent(Event event) {
   brightcoveVideoView.setClosedCaptioningEnabled(true);

    // You could find the desired languaged in the LANGUAGES list.
    // List&lt;String&gt; languages = event.getProperty(Event.LANGUAGES, List.class);
   selectCaption(brightcoveVideoView.getCurrentVideo(), "ja");
 }
});</code></pre>
	</li>
</ol>
</section>
</article>
</div>
      
</div>

</div>


<section class="views-element-container block block-views block-views-blockrelated-content-block-1 clearfix" id="block-views-block-related-content-block-1">
  
    

      <div class="form-group"><div class="view view-related-content view-id-related_content view-display-id-block_1 js-view-dom-id-e54f44566bbae5f8ba7d0afafaf4aef0c0e2fc6c19962fd608fb819a12824a81">
  
    
      <div class="view-header">
      <h2>Related content</h2>
    </div>
      
      <div class="view-content">
      <div class="item-list">
  
  <ul>

          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="removing-android-captions-background-image.html" hreflang="en">Removing the Android Captions Background Image</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="using-captions-brightcove-native-sdks.html" hreflang="en">Using Captions with the Brightcove Native SDKs</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="multiple-audio-tracks-offline-playback-native-sdk-android.html" hreflang="en">Multiple Audio Tracks for Offline Playback with the Native SDK for Android</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="video-formats-and-captioning-native-sdks.html" hreflang="en">Video Formats and Captioning with the Native SDKs</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="synchronizing-webvtt-captions.html" hreflang="en">Synchronizing WebVTT Captions</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="code-snippets-using-native-sdk-android.html" hreflang="en">Code Snippets using the Native SDK for Android</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="ima-open-measurement-native-sdks.html" hreflang="en">IMA Open Measurement with the Native SDKs</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="faq-brightcove-native-player-sdks.html" hreflang="en">FAQ for the Brightcove Native Player SDKs</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="picture-picture-native-sdks.html" hreflang="en">Picture-in-Picture with the Native SDKs</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="live-streams-native-sdks.html" hreflang="en">Live Streams with the Native SDKs</a></span></span></div></li>
    
  </ul>

</div>

    </div>
  
          </div>
</div>

  </section>


  </div>

              </section>

                </div>
  </div>

      
  
  </div>

    
    <script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","scriptPath":null,"pathPrefix":"","currentPath":"node\/18977","currentPathIsAdmin":false,"isFront":false,"currentLanguage":"en"},"pluralDelimiter":"\u0003","google_analytics":{"trackOutbound":true,"trackMailto":true,"trackDownload":true,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"},"bootstrap":{"forms_has_error_value_toggle":1,"modal_animation":1,"modal_backdrop":"true","modal_focus_input":1,"modal_keyboard":1,"modal_select_text":1,"modal_show":1,"modal_size":"","popover_enabled":1,"popover_animation":1,"popover_auto_close":1,"popover_container":"body","popover_content":"","popover_delay":"0","popover_html":0,"popover_placement":"right","popover_selector":"","popover_title":"","popover_trigger":"click"},"ajaxTrustedUrl":{"form_action_p_pvdeGsVG5zNF_XLGPTvYSKCf43t8qZYSwcfZl2uzM":true},"user":{"uid":0,"permissionsHash":"3b7fdb4927baca3ee2939edeb777485b3e2c2d36cf8c80e0d8f49c6dc5e2eeca"}}</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

  <script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","licenseKey":"e78a80aa93","applicationID":"129613202","transactionName":"YwBUZkcFVktUWhJQX1pKd1FBDVdWGn0UTEBVCWpxWhZdZHNWFFRscgpEX3cRUVRRXBQUDkYAWFZQFmhUVFoDUV9YAVNAcwtKVXRaElBfWg==","queueTime":0,"applicationTime":132,"atts":"T0dXEA8fRUU=","errorBeacon":"bam.nr-data.net","agent":""}</script></body>
</html>
