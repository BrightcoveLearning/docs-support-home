<!DOCTYPE html>
<html  lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
<script>(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-2728311-17", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");</script>
<meta name="Generator" content="Drupal 8 (https://www.drupal.org)" />
<meta name="MobileOptimized" content="width" />
<meta name="HandheldFriendly" content="true" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="sites/default/files/favicon-64.png" type="image/png" />
<link rel="alternate" hreflang="en" href="implementing-cue-points-programmatically.html" />
<link rel="canonical" href="implementing-cue-points-programmatically.html" />
<link rel="shortlink" href="implementing-cue-points-programmatically.html" />
<link rel="revision" href="implementing-cue-points-programmatically.html" />

    <title>Implementing Cue Points Programmatically | Brightcove Learning</title>
    <link rel="stylesheet" media="all" href="sites/default/files/css/css_d7PoQ20hWbRiei75VgExP_tm8C1ylIRfzB3zIYLc5Cw_q23msc.css" />
<link rel="stylesheet" media="all" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" />
<link rel="stylesheet" media="all" href="https://cdn.jsdelivr.net/npm/@unicorn-fail/drupal-bootstrap-styles@0.0.2/dist/3.4.0/8.x-3.x/drupal-bootstrap.min.css" />


    
<!--[if lte IE 8]>
<script src="/sites/default/files/js/js_VtafjXmRvoUgAzqzYTA3Wrjkx9wcWhjP0G4ZnnqRamA.js"></script>
<![endif]-->

    <meta name="uri-translation" content="on" />
    <script>
window['_fs_debug'] = false; window['_fs_host'] = 'fullstory.com';
window['_fs_org'] = 'BX3Q1';
window['_fs_namespace'] = 'FS';
(function(m,n,e,t,l,o,g,y){
if (e in m) {if(m.console && m.console.log) { m.console.log('FullStory namespace conflict. Please set window["_fs_namespace"].');} return;}
g=m[e]=function(a,b){g.q?g.q.push([a,b]):g._api(a,b);};g.q=[];
o=n.createElement(t);o.async=1;o.src='https://'+_fs_host+'/s/fs.js';
y=n.getElementsByTagName(t)[0];y.parentNode.insertBefore(o,y);
g.identify=function(i,v){g(l,{uid:i});if(v)g(l,v)};g.setUserVars=function(v){g(l,v)};
g.shutdown=function(){g("rec",!1)};g.restart=function(){g("rec",!0)};
g.consent=function(a){g("consent",!arguments.length||a)};
g.identifyAccount=function(i,v){o='account';v=v||{};v.acctId=i;g(o,v)};
g.clearUserCookie=function(){};
})(window,document,window['_fs_namespace'],'script','user');
    </script>
  </head>
  <body class="path-node page-node-type-support-doc has-glyphicons">


<section id="block-gtranslate" class="block block-gtranslate block-gtranslate-block clearfix">
  
    

      



  </section>


  </div>

      </div>
      

                    <div class="navbar-collapse collapse">
            <div class="region region-navigation-collapsible">
    

  </div>

        </div>
          </header>
  
    <div class="full-width-headline">
    <div class="container">
      <div class="row">
        <div class="col-sm-12" role="heading">
            <div class="region region-header">
          <section id="block-brightcoveheadlineblock" class="block block-bc-general block-bc-general-headline-block clearfix">
  
    

      Documentation
  </section>


  </div>

        </div>
      </div>
    </div>
  </div>
  
      <div role="main" class="main-container container  js-quickedit-main-content">
    <div class="row">

                              <aside class="col-sm-3" role="complementary">
              <div class="region region-sidebar-first">
    <section class="bc-search-fixes-search-block-form block block-bc-search-fixes block-bc-search-fixes-search-block clearfix" data-drupal-selector="bc-search-fixes-search-block-form" id="block-brightcovesearchblock">
  
    

      <form action="implementing-cue-points-programmatically.html" method="post" id="bc-search-fixes-search-block-form" accept-charset="UTF-8">
  <div class="form-item js-form-item form-type-textfield js-form-type-textfield form-item-search js-form-item-search form-no-label form-group">
      <label for="edit-search" class="control-label sr-only">Search</label>
  
  
  <input data-drupal-selector="edit-search" class="form-text form-control" type="text" id="edit-search" name="search" value="" size="15" maxlength="128" placeholder="Search" />

  
  
  </div>
<input autocomplete="off" data-drupal-selector="form-tblobu45xrgbacpqajun4clxgjpxmz6lfu2qjsodfus" type="hidden" name="form_build_id" value="form-tBloBu45XrGBAcPQajUN4ClXgjPXMz6lfu2QJsODFus" /><input data-drupal-selector="edit-bc-search-fixes-search-block-form" type="hidden" name="form_id" value="bc_search_fixes_search_block_form" /><div data-drupal-selector="edit-actions" class="form-actions form-group js-form-wrapper form-wrapper" id="edit-actions"><button data-drupal-selector="edit-submit" class="button js-form-submit form-submit btn-primary btn icon-only" type="submit" id="edit-submit" name="op" value="Search"><span class="sr-only">Search</span><span class="icon glyphicon glyphicon-search" aria-hidden="true"></span></button></div>

</form>

  </section>

<section id="block-inpagenavigationblock" class="hidden-xs block block-bc-ipnav block-bc-ipnav-block clearfix">
  
      <h2 class="block-title">On This Page</h2>
    

      <div class="bc-ipnav-block"></div>
  </section>


  </div>

          </aside>
              
                  <section class="col-sm-9">

                                      <div class="highlighted">  <div class="region region-highlighted">
    <div data-drupal-messages-fallback class="hidden"></div>

  </div>
</div>
                  
                
                
                
                          <a id="main-content"></a>
            <div class="region region-content">
        <h1 class="page-header"><span>Implementing Cue Points Programmatically</span>
</h1>

  
<div class="node node--type-support-doc node--view-mode-full bcdocs-four-rows clearfix">

  

  <div class="group-first-row">
      </div>

  <div class="group-second-row">
  
  <div class="field field--name-field-products field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Product(s)</div>
          <div class="field__items taxonomy__tags">
        <svg class="icon--product" viewBox="0 0 100 100">
          <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--product"></use>
        </svg>
              <div class="field--item">Video Cloud</div>
          <div class="field--item">Brightcove Player</div>
              </div>
      </div>

  <div class="field field--name-field-roles field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Role(s)</div>
          <div class="field__items taxonomy__tags">
        <svg class="icon--roles" viewBox="0 0 100 100">
          <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--roles"></use>
        </svg>
              <div class="field--item">Player Developer</div>
              </div>
      </div>

</div>

  
<div class="group-third-row taxonomy__tags">
      <svg class="icon--label" viewBox="0 0 100 100">
      <use xlink:href="//support.brightcove.com/themes/custom/bcdocs/images/icons.svg#icon--label"></use>
    </svg>
    
  <div class="field field--name-field-topics field--type-entity-reference field--label-visually_hidden">
    <div class="field--label sr-only">Topic(s)</div>
          <div class="field--items">
              <div class="field--item">Cue Points</div>
              </div>
      </div>

</div>

  <div class="group-fourth-row">
  
            <div class="field field--name-field-support-doc-body field--type-text-with-summary field--label-hidden field--item"><p>In this topic, you will gain an understanding of cue points with Brightcove Player. You will then see how to programmatically create cue points and  handle when a cue point is dispatched.</p>
            <style type="text/css"><!--/*--><![CDATA[/* ><!--*/
.video-js {
  		width: 640px;
  		height: 360px;
  	}

/*--><!]]>*/
</style><article class="bcls-article"><section class="bcls-section"><h2 id="Overview">Overview</h2>

<p>Cue points can be set for a video. During video playback, an event is dispatched when each cue point is hit.</p>

<div class="video-cloud-only">
<p>Play the following video to see the player display cue point information at pre-roll, mid-roll (5 seconds, 10 seconds, 12 seconds) and post roll times.</p>
<video-js id="myPlayerID" data-video-id="4740963811001" data-account="1752604059001" data-player="VkIrj2aFx" data-embed="default" class="video-js" controls=""> </video-js><p>******** Cue Point Information ********</p>

<p id="insertionPoint"> </p>

<p>****** End Cue Point Information ******</p>

<aside class="bcls-aside bcls-aside--information">Note: The <strong>id</strong> variables have no associated values since they were not assigned in Video Cloud.</aside></div>

<div class="player-only">
<p>Play this video and you will see information for four cue points displayed below the player.</p>
<video-js id="myPlayerID3" data-account="3676484087001" data-player="4f14e962-a11f-441f-8c00-0c89b8edb0a6" data-embed="default" class="video-js" controls=""> </video-js><p id="insertionPoint3"> </p>
</div>
</section><section class="bcls-section"><h2 id="Key_concepts">Key concepts</h2>

<p><span class="video-cloud-only">A few concepts must be understood to effectively use cue points in Brightcove Player. These concepts are explained in this section of the document.</span><span class="player-only">The following concept must be understood to effectively use cue points in Brightcove Player.</span></p>

<div class="video-cloud-only">
<h3>Video Cloud catalog cue points</h3>

<p>The first concept to understand has to do with terminology. In Brightcove Player, cue points are stored as text track elements, per the HTML standard. This means that when a Video Cloud video is used, any "Video Cloud style" cue points are converted into text tracks.</p>

<p>These "Video Cloud style" cue points can also be referred to as "catalog" cue points since they are read from the Video Cloud catalog (See the <a href="player-catalog.html">Player Catalog</a> document for more information on the catalog). When this conversion takes place, some of the information in the catalog cue point, like type and cue point time, are converted into the text track.</p>

<h3>Catalog cue point structure</h3>

<p>The next concept to understand is that there is significant difference between catalog cue points and the HTML standard in structure. The difference is that an HTML cue point can have a duration. This means for every cue point, two cue point change events will be dispatched: one on start of the cue point and one on end of the cue point.</p>

<p>In the conversion process, every catalog cue point is converted into a cue point with identical start and stop times. This means that for every catalog cue point, two cue point events will be dispatched and has to be accounted for in code.</p>
</div>

<h3><code>activecues</code> array</h3>

<p><span class="video-cloud-only">Another</span><span class="player-only">An</span> important conceptual point to understand when dealing with HTML cue points is the <code>activeCues</code> array. All the cue points are defined in an array. There is another array, <code>activeCues</code>, which holds the cue points which are "active", meaning the playback time is between the cue point's start and stop times.</p>

<p>When using catalog cue points, the start and stop times are identical, so they will be active only for the second defined. Also, with catalog cue points, it is highly unlikely two cue points will be active at the same time since they will not overlap.</p>

<aside class="bcls-aside bcls-aside--information">Note: There can be multiple sets of text tracks, for instance one set for cue points and another for video captions. In the example code in this document, the cue points text tracks are located in both the first and second elements in the TextTracks array. You will see this reflected in code.</aside><h3>Cue point types</h3>

<p>In this document you will see cue points with a <code>type</code> property assigned a value. These type values are assigned when creating cue points in the Studio user interface. There are two types of cue points, but both simply supply a string value to the <code>type</code> property. The appropriate value is helpful only if used in custom JavaScript while processing the cue point information. The types are detailed here:</p>

<ul><li><strong>Ad</strong> - Assigns the string value of <code>AD</code> to the <code>type</code> property</li>
	<li><strong>Code</strong> - Assigns the string value of <code>CODE</code> to the <code>type</code> property</li>
</ul></section><section class="bcls-section video-cloud-only"><h2 id="Video_Cloud_cue_points">Video Cloud cue points</h2>

<p>In this section of the document, you will learn to set catalog cue points and listen for catalog cue point event dispatches.</p>

<h3>Setting Video Cloud cue points</h3>

<p>Video Cloud cue points can be associated with a video using the Video Cloud Studio, and a number of other ways, detailed in this document: <a href="working-cue-points-media-module.html">Working with Cue Points in the Media Module</a>.</p>

<h3>Acting on Video Cloud cue points - video statically bound to the player</h3>

<p>In this section of the document, you will learn to process catalog cue points when the video has been statically bound to the player, meaning the video has been loaded in the player either in Studio or using the Player Management API directly.</p>

<p>To prevent a race condition of trying to process cue points before they are loaded, you need to use the <code>loadedmetadata</code> event to be dispatched before dealing with the cue points. Once the proper text track has been read, use the <code>oncuechange</code> event to listen for cue points events to be dispatched.</p>

<p>The following code shows listening for cue points and displaying the data from the cue point. Note that in this example the video is statically bound to the Player.</p>

<ul><li>Line 24: Create a paragraph element as a location in which to inject dynamically created HTML.</li>
	<li>Lines 31,43: Use the <code>one()</code> method to add an event listener for the <code>loadedmetadata</code> event only once. The event handler function is defined here anonymously.</li>
	<li>Line 32: Retrieve the TextTracks array using the <code>textTracks()</code> method, then assign the zeroth element, which holds the cue points, to the variable <code>tt</code>. Note that it may be possible in some implementations that the cue points could be in a different array element. See the <a href="#findtrack">Find correct track</a> section below for more information.</li>
	<li>Lines 33,41: Sets the event handler function for when the <code>oncuechange</code>event is dispatched.</li>
	<li>Line 34: Check to be sure that you are getting the first (zeroth array element) cue point dispatch. Without this condition, you would see that each cue point would be acted upon twice. Note that if you are using cue points that have durations that overlap this condition would have to be different.</li>
	<li>Lines 35-39: Dynamically create HTML using information from the cue point and inject into the HTML page.</li>
	<li>Line 42: Play the video.</li>
</ul><pre class="line-numbers" data-start="17">
<code class="language-html">&lt;video-js id="myPlayerID"
data-account="1507807800001"
data-player="6aac508a-741e-41a2-bc7a-5805644cf089"
data-embed="default"
data-video-id="1507781667001"
class="video-js" controls&gt;&lt;/video-js&gt;

&lt;p id="insertionPoint"&gt;&lt;/p&gt;
&lt;script src="https://players.brightcove.net/1507807800001/6aac508a-741e-41a2-bc7a-5805644cf089_default/index.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var player = this;
    player.one("loadedmetadata", function () {
      var tt = player.textTracks()[0];
      tt.oncuechange = function () {
        if (tt.activeCues[0] !== undefined) {
          var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
          dynamicHTML += "text: " + tt.activeCues[0].text + ", ";
          dynamicHTML += "startTime: " + tt.activeCues[0].startTime + ",  ";
          dynamicHTML += "endTime: " + tt.activeCues[0].endTime;
          document.getElementById("insertionPoint").innerHTML += dynamicHTML + "&lt;br/&gt;";
        }
      }
      player.play();
    });
  });
&lt;/script&gt;</code></pre>

<h3>Acting on Video Cloud cue points - dynamically load video in the player</h3>

<p>In this section of the document, you will learn to process catalog cue points when the video is dynamically loaded into the player using the <code>catalog.getVideo()</code> and <code>catalog.load()</code> methods.</p>

<p>When you use the player catalog to get and load the video, processing cue points is bit easier than when you use a statically bound video, as you do not need to use the <code>loadedmetadata</code> event.</p>

<ul><li>Line 76: Create a paragraph element as a location in which to inject dynamically created HTML.</li>
	<li>Lines 83,97: Use the <code>catalog.getVideo()</code> method to retrieve a video. The callback function is defined here anonymously.</li>
	<li>Line 85: Use the <code>catalog.load()</code> method to load the video into the player.</li>
	<li>Line 86: Retrieve the TextTracks array using the <code>textTracks()</code> method, then assign the zeroth element, which holds the cue points, to the variable <code>tt</code>. Note that it may be possible in some implementations that the cue points could be in a different array element. See the <a href="#findtrack">Find correct track</a> section below for more information.</li>
	<li>Lines 87,95: Sets the event handler function for when the <code>oncuechange</code>event is dispatched.</li>
	<li>Line 88: Check to be sure the first (zeroth array element) cue point is defined. Without this condition you would see that each cue point would be acted upon twice, the second time with no defined elements in the <code>activecues</code> array (since the second cue change is for cue point end). Note that if you are using cue points that have durations that overlap this condition would have to be different.</li>
	<li>Lines 89-93: Dynamically create HTML using information from the cue point and inject into the HTML page.</li>
	<li>Line 96: Play the video.</li>
</ul><pre class="line-numbers" data-start="69">
<code class="language-html">&lt;video-js id="myPlayerID"
  data-account="1507807800001"
  data-player="3c59134e-89e8-4864-87e2-3cc871f8c361"
  data-embed="default"
  data-video-id=""
  class="video-js" controls&gt;&lt;/video-js&gt;

  &lt;p id="insertionPoint"&gt;&lt;/p&gt;

  &lt;script src="https://players.brightcove.net/1507807800001/3c59134e-89e8-4864-87e2-3cc871f8c361_default/index.min.js"&gt;&lt;/script&gt;

  &lt;script&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var player = this;
    player.catalog.getVideo('1507781667001', function (error, video) {
      //deal with error
      player.catalog.load(video);
      player.one("loadedmetadata", function () {
        var tt = player.textTracks()[0];
        tt.oncuechange = function () {
          if (tt.activeCues[0] !== undefined) {
            var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
            dynamicHTML += "text: " + tt.activeCues[0].text + ", ";
            dynamicHTML += "startTime: " + tt.activeCues[0].startTime + ",  ";
            dynamicHTML += "endTime: " + tt.activeCues[0].endTime;
            document.getElementById("insertionPoint").innerHTML += dynamicHTML + "&lt;br/&gt;";
          }
        }
      });
      player.play();
    });
  });
&lt;/script&gt;</code></pre>

<h3 id="allvcinfo">Retrieve all Video Cloud cue point info</h3>

<p>As you may have noticed not all Video Cloud cue point information is directly available to you from the <code>activecues</code> array. This is easily remedied by retrieving the desired info from the <code>mediainfo</code> property.</p>

<p>The basic approach of this solution is:</p>

<ol><li>Wait for the <code>loadstart</code> event for the <code>mediainfo</code> property to be populated.</li>
	<li>Assign the <code>cue_points</code> array from the <code>mediainfo</code> property to a variable. This variable contains complete Video Cloud cue point information.</li>
	<li>On a cue point event, retrieve the corresponding cue point data based on the <code>time</code> property value. This will be done using a helper function that grabs an object out of an array based on a property value in the object.</li>
	<li>Use the data from the cue point.</li>
</ol><p>The following image shows the entire cue point array (top-left), the single cue point data collection (top-right), and one property from that single cue point data collection (bottom-right).</p>

<figure class="bcls-figure"><img class="bcls-image" alt="cue point data" src="https://learning-services-media.brightcove.com/doc-assets/player-development/player-customization/cue-points/using-cue-points/cue-point-all-vc-data.png" /></figure><p>In the snippet below only the new/changed code from examples above will be explained.</p>

<ul><li>Lines 452-463: Include the function that will be used to extract a single cue point data collection from the array of all cue points. Note that you pass it the array of all cue points, the property in which you are searching for a specific value, and lastly the value you are searching for.</li>
	<li>Line 432: Listens for the <code>loadstart</code> event. When your video starts to load, then the <code>mediainfo</code> property is populated.</li>
	<li>Line 434: Assign the array of all Video Cloud cue points to a variable.</li>
	<li>Line 443: In the cue point dispatch event handler, assign the specific cue point's data collection to a variable. This is where the function mentioned in the first bullet point is called. The arguments used are:
	<ul><li><code>cuePointAra</code>: The entire collection of Video Cloud cue points.</li>
		<li><code>'time'</code>: The property in which to search for a value.</li>
		<li><code>tt.activeCues[0].startTime</code>: The start time of the cue point currently being handled in the cue point dispatch event handler.</li>
	</ul></li>
	<li>Lines 444-445: Debugging <code>console.log()</code> method calls, which should be removed in production code.</li>
</ul><pre class="line-numbers" data-start="426">
<code class="language-html">&lt;script&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var myPlayer = this,
      cuePointAra = [],
      allCuePointData;
    myPlayer.on('loadstart', function () {
      //console.log('mediainfo', myPlayer.mediainfo);
      cuePointAra = myPlayer.mediainfo.cue_points;
      var tt = myPlayer.textTracks()[0];
      tt.oncuechange = function () {
        if (tt.activeCues[0] !== undefined) {
          var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
          dynamicHTML += "text: " + tt.activeCues[0].text + ", ";
          dynamicHTML += "startTime: " + tt.activeCues[0].startTime + ",  ";
          dynamicHTML += "endTime: " + tt.activeCues[0].endTime;
          document.getElementById("insertionPoint").innerHTML += dynamicHTML + "&lt;br/&gt;";
          allCuePointData = getSubArray(cuePointAra, 'time', tt.activeCues[0].startTime);
          console.log('cue point data:', allCuePointData);
          console.log('cue point metadata:', allCuePointData[0].metadata);
        }
      }
      myPlayer.play();
      myPlayer.muted(true);
    });

    function getSubArray(targetArray, objProperty, value) {
      var i, totalItems = targetArray.length,
        objFound = false,
        idxArr = [];
      for (i = 0; i &lt; totalItems; i++) {
        if (targetArray[i][objProperty] === value) {
          objFound = true;
          idxArr.push(targetArray[i]);
        }
      }
      return idxArr;
    };
  });
&lt;/script&gt;</code></pre>
</section><section class="bcls-section"><h2 id="HTML5_standard_cue_points">HTML5 standard cue points</h2>

<p>HTML5 standard cue points are stored as track elements in a prescribed format. Good introductory content can be found in the following HTML5 Rocks tutorial: <a href="https://www.html5rocks.com/en/tutorials/track/basics/">Getting Started With the Track Element</a>. In this section of the document, you will learn the format of WebVTT cue point files and then how to process those cue points.</p>

<h3>WebVTT file format for cue points</h3>

<p>The WebVTT file format is strictly defined. For cue points the file is composed as follows:</p>

<ul><li>The string <strong>WebVTT</strong> as the first line of the file</li>
	<li>A single blank line</li>
	<li>The identifier for a specific cue point</li>
	<li>The duration in the form <strong>00:00:00.000 --&gt; 00:00:00.000</strong>; this is hours:minutes:seconds.milliseconds format and is strictly parsed; numbers must be zero padded if necessary</li>
	<li>The characters following the duration to the next blank line are place into a <strong>text</strong> value; if you wish to store multiple, disparate values here JSON works well as it can be easily parsed</li>
	<li>A single blank line</li>
	<li>Multiple cue points can be added using the identifier/duration/text/blank line format</li>
</ul><aside class="bcls-aside bcls-aside--tip">Note: You can validate your WebVTT format with this <a href="https://quuz.org/webvtt/">validator</a>.</aside><p>The following is a valid WebVTT cue point document that defines two cue points, one with a duration from 2-5 seconds and another with duration from 10-15 seconds:</p>

<pre class="line-numbers">
<code class="language-javascript">WEBVTT

multiCell
00:00:02.000 --&gt; 00:00:05.000
{
"title": "Multi-celled organisms",
"description": "Multi-celled organisms have different types of cells that perform specialized functions.",
"src": "multiCell.jpg",
"href": "http://en.wikipedia.org/wiki/Multicellular"
}

insects
00:00:10.000 --&gt; 00:00:15.000
{
"title": "Insects",
"description": "Insects are the most diverse group of animals on the planet with estimates for the total number of current species range from two million to 50 million. The first insects appeared around 400 million years ago, identifiable by a hard exoskeleton, three-part body, six legs, compound eyes and antennae.",
"src": "insects.jpg",
"href": "http://en.wikipedia.org/wiki/Insects"
}</code></pre>

<p>When you play the following video, you will see the cue point WebVTT file shown above processed. At the start of a cue point, you see dynamically created HTML injected into the page, followed by some parsed JSON from the <strong>text</strong> field. At the end of the cue point the message <strong>Cue point duration over</strong> is displayed.</p>
<video-js id="myPlayerID2" data-video-id="4607357817001" data-account="1752604059001" data-player="VkIrj2aFx" data-embed="default" class="video-js" controls=""><track kind="metadata" src="https://solutions.brightcove.com/bcls/tests/player/cuepoints.vtt"></track></video-js><p>******** Cue Point Information ********</p>

<p id="insertionPoint2"> </p>

<p>****** End Cue Point Information ******</p>

<h3>Process cue points overview</h3>

<p>The basics steps to use HTML5 standard cue points are:</p>

<ol><li>Read in the WebVTT file containing the cue points using a <code>&lt;track&gt;</code> tag nested as a child of the <code>&lt;video-js&gt;</code> tag.</li>
	<li>In a <code>loadedmetadata</code> event handler, retrieve the proper text track element.</li>
	<li>In the same event handler, configure a second event handler for the <code>oncuechange</code> cue point event.</li>
	<li>In the <code>oncuechange</code> event handler, check if the <code>activecues</code> array object has zeroth element defined, if yes, act on the cue point start.
	<aside class="bcls-aside bcls-aside--information">Note: You will have <code>oncuechange</code> events dispatched when the cue point both starts and stops. The <code>activecues</code> array will have a value only for the duration of the cue point. Hence, if an <code>oncuechange</code> event occurs and there are no defined objects in the <code>activecues</code> array, you know the dispatched event is for a cue point stop.</aside></li>
	<li>In the <code>oncuechange</code> event handler, check if the <code>activecues</code> array object has zeroth element defined, if no, act on the cue point stop.</li>
</ol><aside class="bcls-aside bcls-aside--information">Note: If your cue points have overlapping durations, the logic in the above steps will need to be slightly altered.</aside><div class="video-cloud-only">
<h3>Process cue points code</h3>

<p> </p>

<ul><li>Line 122: Create a text track by reading in the WebVTT file using the <code>&lt;track&gt;</code> tag.</li>
	<li>Line 126: Create a paragraph element as a location in which to inject dynamically created HTML.</li>
	<li>Lines 134,152: Use the <code>one()</code> method to listen only once for the <code>loadedmetadata</code> event. The event handler function is defined here anonymously.</li>
	<li>Line 135: Assign to a variable the index of the last text track loaded.</li>
	<li>Line 136: Retrieve the textTracks array using the <code>textTracks()</code> method the assign the last element of the array to a variable using the index determined in the previous step. See the <a href="#findtrack">Find correct track</a> section below for variations on this logic.</li>
	<li>Lines 137,149: Sets the event handler function for when the <code>oncuechange</code>event is dispatched.</li>
	<li>Line 138: Check to be sure the first (zeroth array element) cue point is defined in the activeCues array. This tells you that this is a start cue point event.</li>
	<li>Lines 139-145: Dynamically create HTML using information from the cue point and inject into the HTML page. This includes parsing JSON and displaying various fields of that JSON.</li>
	<li>Lines 146-147: Display a note that the cue point end has been reached.</li>
	<li>Line 150: Play the video.</li>
</ul><pre class="line-numbers" data-start="115">
<code class="language-html">&lt;video-js id="myPlayerID2"
  data-account="1752604059001"
  data-player="8cfb6785-c4be-43b4-af68-7ca2fe3a6ebf"
  data-embed="default"
  data-video-id="3851380732001"
  class="video-js" controls&gt;

  &lt;track kind="metadata" src="https://solutions.brightcove.com/bcls/tests/player/cuepoints.vtt" /&gt;
&lt;/video-js&gt;

&lt;p id="insertionPoint2"&gt;&lt;/p&gt;

&lt;script src="https://players.brightcove.net/1752604059001/8cfb6785-c4be-43b4-af68-7ca2fe3a6ebf_default/index.min.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript"&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var myPlayer = this;
    myPlayer.one("loadedmetadata", function () {
      var trackIndex = myPlayer.textTracks().length - 1;
      var tt = myPlayer.textTracks()[trackIndex];
      tt.oncuechange = function () {
        if (tt.activeCues[0] !== undefined) {
          var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
          dynamicHTML += "text: " + tt.activeCues[0].text + ", ";
          dynamicHTML += "startTime: " + tt.activeCues[0].startTime + ",  ";
          dynamicHTML += "endTime: " + tt.activeCues[0].endTime;
          document.getElementById("insertionPoint2").innerHTML += dynamicHTML + "&lt;br/&gt;&lt;br/&gt;";
          jsonData = JSON.parse(tt.activeCues[0].text);
          document.getElementById("insertionPoint2").innerHTML += jsonData.title + ": " + jsonData.description + "&lt;br/&gt;&lt;br/&gt;";
        } else {
          document.getElementById("insertionPoint2").innerHTML += "Cue point duration over" + "&lt;br/&gt;&lt;br/&gt;";
        }
      } //end oncuechange
      myPlayer.play();
      myPlayer.muted(true);
    }); //end loadedmetadata
  }); //end ready
&lt;/script&gt;</code></pre>
</div>

<div class="player-only">
<h3>Process cue points code</h3>

<p> </p>

<ul><li>Line 270: Create a text track by reading in the WebVTT file using the <code>&lt;track&gt;</code> tag.</li>
	<li>Line 273: Create a paragraph element as a location in which to inject dynamically created HTML.</li>
	<li>Lines 285,309: Use the <code>one()</code> method to listen only once for the <code>loadedmetadata</code> event. The event handler function is defined here anonymously.</li>
	<li>Line 286: Assign to a variable the index of the last text track loaded.</li>
	<li>Line 287: Retrieve the textTracks array using the <code>textTracks()</code> method the assign the last element of the array to a variable using the index determined in the previous step. See the <a href="#findtrack">Find correct track</a> section below for variations on this logic.</li>
	<li>Lines 289,301: Sets the event handler function for when the <code>oncuechange</code>event is dispatched.</li>
	<li>Line 290: Check to be sure the first (zeroth array element) cue point is defined in the activeCues array. This tells you that this is a start cue point event.</li>
	<li>Lines 291-294: Dynamically create HTML using information from the cue point and inject into the HTML page. This includes parsing JSON and displaying various fields of that JSON.</li>
	<li>Lines 295-297: Display a note that the cue point end has been reached.</li>
	<li>Line 302: Play the video.</li>
</ul><p> </p>
</div>

<p>One could assume you could add the WebVTT file programmatically using the <code>addRemoteTextTrack()</code> method. In this case, it would not be reliable since you can experience a race condition where the cue points would not be ready to process before trying to use them. It is safe to add the WebVTT file using the <code>&lt;track&gt;</code> tag as shown.</p>
</section><section class="bcls-section"><h2 id="Find_correct_track">Find correct track</h2>

<p>In a number of places in this document a possible problem could occur if multiple text tracks are associated with a player. An assumption was made that only one text track is associated with the player so this code was used: <code>var tt = myPlayer.textTracks()[0];</code>. Selecting the zeroth array element assumes a single text track associated the player.</p>

<p>Text tracks are not only used for cue points, but other kinds of data also. The <strong>kind</strong> attribute can contain the following values:</p>

<ul><li>subtitles</li>
	<li>captions</li>
	<li>descriptions</li>
	<li>chapters</li>
	<li>metadata</li>
</ul><p>This means it is very possible multiple text tracks could be associated with the player, and a way is needed to find the correct one for your application logic. The following code loops over the available text tracks until the <strong>metadata</strong> (cue point) value is found:</p>

<pre class="line-numbers">
<code class="language-html">&lt;script type="text/javascript"&gt;
  videojs.getPlayer('myPlayerID').ready(function() {
    var myPlayer = this,
      allTextTacks,
      attLength,
      tt;
    myPlayer.one("loadedmetadata", function () {
      allTextTacks = myPlayer.textTracks();
      attLength = allTextTacks.length;
      for (var i = 0; i &lt; attLength; i++) {
        if (allTextTacks[i].kind === 'metadata') {
          tt = allTextTacks[i];
          break;
        };
      };
    });
  });
&lt;/script&gt;</code></pre>

<p>The logic from previous examples could then be used to process the cue points using the <code>tt</code> variable, which contains the wanted text track.</p>
</section><section class="bcls-section video-cloud-only"><h2 id="Programmatic_cue_points">Programmatic cue points</h2>

<p>It is possible to programmatically add cue points. The key method comes from the HTML5 <code>VTTCue</code> interface. You can create cue points use the following syntax:</p>

<pre>
<code class="language-javascript">new VTTCue( startTime, endTime, text )</code></pre>

<p>The logic of processing the cue points is very similar to previous examples, so only the code different from that used above will be detailed.</p>

<ul><li>
	<p>Lines 43,44: Adds a <code>textTrack</code> element to the player using the player's <code>addRemoteTextTrack()</code> method. Specify the <code>kind</code> to be <strong>metadata</strong>, and a <code>label</code>, in this case <strong>Timed Cue Point</strong>.</p>

	<aside class="bcls-aside bcls-aside--information">Note: Because only remote text tracks can be removed from a player, we recommend using the <a href="https://docs.brightcove.com/brightcove-player/current-release/Player.html#addRemoteTextTrack">addRemoteTextTrack()</a> method.</aside></li>
	<li>
	<p>Lines 45-48: Wait 10 milliseconds before creating two cue points using the player's <code>addCue()</code> method. The cue points are instantiated using HTML5's <code>VTTCue()</code> constructor.</p>

	<aside class="bcls-aside bcls-aside--tip">For Safari and iOS, you need to delay before adding cue points or they don't get added. This is because the Brightcove Player uses native, asynchronous tracks in the Safari browser and on iOS.</aside></li>
	<li>Line 22: Listens for the <code>addtrack</code> event.</li>
	<li>Line 23: Retrieves all text tracks associated with the player.</li>
	<li>Line 24: Sets the <code>attLength</code> variable to the number of text tracks. This value will be used in a loop in the next code segment.</li>
	<li>Lines 25-30: Loop over each text track checking for the <code>label</code> to be equal to the correct value. When found, assign the current text track to a variable and break out of the loop.</li>
</ul><aside class="bcls-aside bcls-aside--tip">Note: Outside of the learning sample code that follows, it is very likely the cue points would be created looping over some data structure containing key cue point info.</aside><pre class="line-numbers" data-start="1">
<code class="language-html">&lt;video-js id="myPlayerID"
  data-video-id="4607746980001"
  data-account="1507807800001"
  data-player="default"
  data-embed="default"
  class="video-js"
  width="640" height="360"
  controls&gt;&lt;/video-js&gt;

&lt;script src="https://players.brightcove.net/1507807800001/default_default/index.min.js"&gt;&lt;/script&gt;

&lt;p id="insertionPoint"&gt;&lt;/p&gt;

&lt;script type="text/javascript"&gt;
  videojs.getPlayer("myPlayerID").ready(function () {
    var myPlayer = this,
      textTrack = [],
      allTextTacks,
      attLength,
      tt;
    myPlayer.one("loadedmetadata", function () {
      myPlayer.textTracks().addEventListener('addtrack', function () {
        allTextTacks = myPlayer.textTracks();
        attLength = allTextTacks.length;
        for (var i = 0; i &lt; attLength; i++) {
          if (allTextTacks[i].label === 'Timed Cue Point') {
            tt = allTextTacks[i];
            break;
          }
        }
        tt.oncuechange = function () {
          if (tt.activeCues[0] !== undefined) {
            var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
            dynamicHTML += "text: &lt;strong&gt;" + tt.activeCues[0].text + "&lt;/strong&gt;, ";
            dynamicHTML += "startTime: &lt;strong&gt;" + tt.activeCues[0].startTime + "&lt;/strong&gt;,  ";
            dynamicHTML += "endTime: &lt;strong&gt;" + tt.activeCues[0].endTime + "&lt;/strong&gt;";
            document.getElementById("insertionPoint").innerHTML += dynamicHTML + "&lt;br/&gt;&lt;br/&gt;";
          } else {
            document.getElementById("insertionPoint").innerHTML += "Cue point duration over" + "&lt;br/&gt;&lt;br/&gt;";
          }
        }; //end oncuechange
      }); // end playing
      textTrack = myPlayer.addRemoteTextTrack({kind: 'metadata', label: 'Timed Cue Point', mode: 'hidden'}, false);
      textTrack.track.mode = 'hidden';
      setTimeout(function(){
        textTrack.track.addCue(new window.VTTCue(2, 5, 'cue point 1 text'));
        textTrack.track.addCue(new window.VTTCue(10, 15, 'cue point 2 text'));
      }, 10);
    }); //end on loadedmetadata
  }); //end ready
&lt;/script&gt;</code></pre>

<p>The code generates output as shown in the following screenshot. Note the <strong>id</strong> values are not supplied a value when using the <code>VTTCue()</code> constructor method.</p>

<figure class="bcls-figure"><img class="bcls-image" alt="dynamic cue points" src="https://learning-services-media.brightcove.com/doc-assets/player-development/player-customization/cue-points/using-cue-points/cue-points-dynamic.png" /></figure></section><section class="bcls-section"><h2 id="ID3_and_media_cue_points">ID3 and media cue points</h2>

<p>If you have ID3 cue points or media cue points associated with your media you can deal with them using the <code>id3CuePointsTrack()</code> and <code>mediaCuePointsTrack()</code> methods. For instance, to listen for cue point changes you would use the following:</p>

<pre class="line-numbers">
<code class="language-javascript">videojs.getPlayer('myPlayerID').ready(function () {
  var myPlayer = this;
  myPlayer.one("canplay", function () {
    <span class="bcls-highlight">myPlayer.id3CuePointsTrack().on('cuechange', function () {
      // process cue point here
    });</span>
  });
});</code></pre>

<h3>ID3 Details</h3>

<p>The following provide more insight into using ID3 cue points:</p>

<ul><li>ID3 tags can be used to insert timed metadata into the stream.</li>
	<li>You can have multiple ID3 frames per segment.</li>
	<li>Brightcove Player parses ID3 cue points and exposes them as a Text Track, using the aforementioned <code>id3CuePointsTrack()</code> method.</li>
	<li>It is a best practice to wait for the <code>canplay</code> event or there is a possibility the track would not be retrievable when trying to access it.</li>
	<li>Multiple frames per tag is supported.</li>
</ul></section><section class="bcls-section"><h2 id="Known_issues">Known issues</h2>

<ul><li>On Safari, cue points will not trigger if end time is equal to start time. So if Safari compatibility is an issue, the cue points need a duration greater than zero.</li>
</ul></section></article><script src="https://players.brightcove.net/1752604059001/VkIrj2aFx_default/index.min.js"></script><script src="https://players.brightcove.net/3676484087001/4f14e962-a11f-441f-8c00-0c89b8edb0a6_default/index.min.js"></script><script>
<!--//--><![CDATA[// ><!--

  videojs.getPlayer('myPlayerID').ready(function() {
  	var player = this;
  	player.one("loadedmetadata",function(){
  		var tt = player.textTracks()[0];
  		tt.oncuechange = function() {
  			if(tt.activeCues[0] !== undefined){
  				var dynamicHTML = "id: <strong>" + tt.activeCues[0].id + ", ";
  				dynamicHTML += "text: <strong>" + tt.activeCues[0].text + ", ";
  				dynamicHTML += "startTime: <strong>" + tt.activeCues[0].startTime + ",  ";
  				dynamicHTML += "endTime: <strong>" + tt.activeCues[0].endTime + "";
  				document.getElementById("insertionPoint").innerHTML += dynamicHTML + "<br/>";
  			}
  		}
  		//player.play();
  		player.muted(true);
  	});
  });
  
//--><!]]>
</script><script type="text/javascript">
<!--//--><![CDATA[// ><!--

  videojs.getPlayer('myPlayerID2').ready(function() {
  	var myPlayer = this;

  	myPlayer.one("loadedmetadata",function(){
  		var trackIndex = myPlayer.textTracks().length -1;
  		var tt = myPlayer.textTracks()[trackIndex];
  		tt.oncuechange = function() {
  			if(tt.activeCues[0] !== undefined){
console.log('tt.activeCues[0]',tt.activeCues[0]);
  				var dynamicHTML = "id: <strong>" + tt.activeCues[0].id + ", ";
  				dynamicHTML += "text: <strong>" + tt.activeCues[0].text + ", ";
  				dynamicHTML += "startTime: <strong>" + tt.activeCues[0].startTime + ",  ";
  				dynamicHTML += "endTime: <strong>" + tt.activeCues[0].endTime + "";
  				document.getElementById("insertionPoint2").innerHTML += dynamicHTML + "<br/><br/>";
  				jsonData = JSON.parse(tt.activeCues[0].text);
  				document.getElementById("insertionPoint2").innerHTML += jsonData.title + ": " + jsonData.description + "<br/><br/>";
  			} else {
  				document.getElementById("insertionPoint2").innerHTML += "<strong>Cue point duration over" + "<br/><br/>";
  			}
  		} //end oncuechange
  		//myPlayer.play();
  		myPlayer.muted(true);
  	}); //end loadedmetadata

  }); //end ready
  
//--><!]]>
</script><script type="text/javascript">
<!--//--><![CDATA[// ><!--

  var myPlayer3,
  textTrack;

  videojs.getPlayer('myPlayerID3').ready(function() {
  	var myPlayer3 = this;
  	myPlayer3.src({
  		"type": "video/mp4",
  		"src": "//solutions.brightcove.com/bcls/assets/videos/Water-In-Motion.mp4"
  	});
  	textTrack = myPlayer3.addTextTrack('metadata', 'Timed Cue Point');
  	textTrack.addCue(new window.VTTCue(2,4,'cue point 1 text'));
  	textTrack.addCue(new window.VTTCue(6,8,'cue point 2 text'));
  	textTrack.addCue(new window.VTTCue(10,11,'cue point 3 text'));
  	textTrack.addCue(new window.VTTCue(15,20,'cue point 4 text - LAST CUEPOINT'));
  	var tt = myPlayer3.textTracks()[0];
  	tt.oncuechange = function() {
  		if(tt.activeCues[0] !== undefined){
  			//var dynamicHTML = "id: " + tt.activeCues[0].id + ", ";
  			var dynamicHTML = "text: <strong>" + tt.activeCues[0].text + ", ";
  			dynamicHTML += "startTime: <strong>" + tt.activeCues[0].startTime + ",  ";
  			dynamicHTML += "endTime: <strong>" + tt.activeCues[0].endTime + "";
  			document.getElementById("insertionPoint3").innerHTML += dynamicHTML + "<br/>";
  		} else {
  			document.getElementById("insertionPoint3").innerHTML += "Cue point duration over" + "<br/><br/>";
  		}
  	} //end oncuechange
  }); //end ready
  
//--><!]]>
</script></div>
      
</div>

</div>


<section class="views-element-container block block-views block-views-blockrelated-content-by-field-block-1 clearfix" id="block-views-block-related-content-by-field-block-1">
  
    

      <div class="form-group"><div class="view view-related-content-by-field view-id-related_content_by_field view-display-id-block_1 js-view-dom-id-374312577f93af48156f8297e8f6452be342d0a024815cb9521c93c045212095">
  
    
      <div class="view-header">
      <h2>Related content</h2>
    </div>
      
      <div class="view-content">
      <div class="item-list">
  
  <ul>

          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="player-catalog.html" hreflang="en">Player Catalog</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="working-cue-points-media-module.html" hreflang="en">Working with Cue Points in the Media Module</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="brightcove-player-sample-cue-points-display-cta.html" hreflang="en">Brightcove Player Sample: Cue Points Display CTA</a></span></span></div></li>
          <li><div class="views-field views-field-title"><span class="field-content"><span class="content-type-support_doc"><a href="displaying-ads-using-ad-cue-points.html" hreflang="en">Displaying Ads Using Ad Cue Points</a></span></span></div></li>
    
  </ul>

</div>

    </div>
  
          </div>
</div>

  </section>


  </div>

              </section>

                </div>
  </div>

      
  
  </div>

    
    <script type="application/json" data-drupal-selector="drupal-settings-json">{"path":{"baseUrl":"\/","scriptPath":null,"pathPrefix":"","currentPath":"node\/18123","currentPathIsAdmin":false,"isFront":false,"currentLanguage":"en"},"pluralDelimiter":"\u0003","google_analytics":{"trackOutbound":true,"trackMailto":true,"trackDownload":true,"trackDownloadExtensions":"7z|aac|arc|arj|asf|asx|avi|bin|csv|doc(x|m)?|dot(x|m)?|exe|flv|gif|gz|gzip|hqx|jar|jpe?g|js|mp(2|3|4|e?g)|mov(ie)?|msi|msp|pdf|phps|png|ppt(x|m)?|pot(x|m)?|pps(x|m)?|ppam|sld(x|m)?|thmx|qtm?|ra(m|r)?|sea|sit|tar|tgz|torrent|txt|wav|wma|wmv|wpd|xls(x|m|b)?|xlt(x|m)|xlam|xml|z|zip"},"bootstrap":{"forms_has_error_value_toggle":1,"modal_animation":1,"modal_backdrop":"true","modal_focus_input":1,"modal_keyboard":1,"modal_select_text":1,"modal_show":1,"modal_size":"","popover_enabled":1,"popover_animation":1,"popover_auto_close":1,"popover_container":"body","popover_content":"","popover_delay":"0","popover_html":0,"popover_placement":"right","popover_selector":"","popover_title":"","popover_trigger":"click"},"ajaxTrustedUrl":{"form_action_p_pvdeGsVG5zNF_XLGPTvYSKCf43t8qZYSwcfZl2uzM":true},"user":{"uid":0,"permissionsHash":"3b7fdb4927baca3ee2939edeb777485b3e2c2d36cf8c80e0d8f49c6dc5e2eeca"}}</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

  <script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","licenseKey":"e78a80aa93","applicationID":"129613202","transactionName":"YwBUZkcFVktUWhJQX1pKd1FBDVdWGkkHXlVrBldRXQE=","queueTime":0,"applicationTime":24,"atts":"T0dXEA8fRUU=","errorBeacon":"bam.nr-data.net","agent":""}</script></body>
</html>
